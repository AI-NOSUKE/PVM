# PVM (Phantom Vector Mapping)
**äºŒæ®µéš ICA ã«ã‚ˆã‚‹æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³**  
PCA â†’ ICAâ‘  â†’ KMeans â†’ ICAâ‘¡ï¼ˆã‚»ãƒ³ãƒˆãƒ­ã‚¤ãƒ‰å†åˆ†è§£ï¼‰â†’ KMeans ã®äºŒæ®µéšã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’ç”¨ã„ã¦ã€è§£é‡ˆå¯èƒ½ã§å†ç¾æ€§ã®é«˜ã„ã‚¯ãƒ©ã‚¹ã‚¿ã‚’å¾—ã‚‹ãŸã‚ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã§ã™ã€‚

æœ¬ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ãã®æ‰‹æ³•ã‚’Pythonã§å®Ÿè£…ã—ã€æ—¥æœ¬èªå‘ã‘ã«æœ€é©åŒ–ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

## ğŸ”’ ã‚»ã‚­ãƒ¥ã‚¢ã§ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµï¼ˆæœ¬å®Ÿè£…ã®ç‰¹é•·ï¼‰
ã“ã®å®Ÿè£…ã§ã¯ã€ãƒ¢ãƒ‡ãƒ«ã®åˆå›ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é™¤ãã€**ã™ã¹ã¦ã®å‡¦ç†ãŒãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Œçµ**ã—ã¾ã™ã€‚  
å¤–éƒ¨APIã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç”¨ã„ãšã€**ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚„å€‹äººæƒ…å ±ãŒå¤–éƒ¨ã«é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**

> ğŸ’¡ PVMã¨ã„ã†æ‰‹æ³•è‡ªä½“ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ã©ã¡ã‚‰ã§ã‚‚å®Ÿè£…å¯èƒ½ã§ã™ãŒã€**æœ¬å®Ÿè£…ã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å®‰å…¨ãªåˆ©ç”¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚**

![python](https://img.shields.io/badge/python-3.11%2B-blue)
![license](https://img.shields.io/badge/License-PVM%20v1.2-green)
![release](https://img.shields.io/github/v/release/AI-NOSUKE/PVM?color=orange)
![ci](https://github.com/AI-NOSUKE/PVM/actions/workflows/ci.yml/badge.svg)

---

## ç›®æ¬¡
- [æ¦‚è¦](#æ¦‚è¦)
- [ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰](#ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ­ãƒ¼ã‚«ãƒ«)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
  - [â‘  CIã‚µãƒ³ãƒ—ãƒ«ï¼ˆå¿…ãšé€šã‚‹æœ€å°ãƒ†ã‚¹ãƒˆï¼‰](#qs-ci)
  - [â‘¡ ãƒ­ãƒ¼ã‚«ãƒ«åˆ©ç”¨ï¼ˆæœ€å°ã‚³ãƒãƒ³ãƒ‰ï¼‰](#qs-local)
- [ä¸»ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆåŸºæœ¬ï¼‰](#ä¸»ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³åŸºæœ¬)
- [è£œåŠ©ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆãã®ä»–ï¼‰](#è£œåŠ©ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãã®ä»–)
- [å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«](#å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«)
- [é‹ç”¨ã®ç›®å®‰ã¨å†ç¾æ€§](#é‹ç”¨ã®ç›®å®‰ã¨å†ç¾æ€§)
- [å­¦è¡“èƒŒæ™¯ï¼ˆè¦ç‚¹ï¼‰](#å­¦è¡“èƒŒæ™¯è¦ç‚¹)
- [ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ / ä½œè€…](#ãƒ©ã‚¤ã‚»ãƒ³ã‚¹--ä½œè€…)

---

## æ¦‚è¦
- **ç›®çš„**ï¼šå®Ÿå‹™ã§ã€Œæ„å‘³ãŒå–ã‚Šå‡ºã—ã‚„ã™ã„ã‚¯ãƒ©ã‚¹ã‚¿ã€ã‚’å®‰å®šã—ã¦å¾—ã‚‹ã€‚
- **ç‰¹å¾´**ï¼š
  - **äºŒæ®µéš ICA**ï¼šä¸€æ¬¡ã®ç‹¬ç«‹æˆåˆ†ã§å¤§æ ã‚’æ´ã¿ã€**ã‚¯ãƒ©ã‚¹ã‚¿é‡å¿ƒã‚’å†åˆ†è§£ï¼ˆICAâ‘¡ï¼‰**ã—ã¦è¼ªéƒ­ã‚’æ•´ãˆã‚‹ã€‚
  - **å€™è£œâ†’æ¡ç”¨â†’ãƒ­ãƒƒã‚¯/ã‚¢ãƒ³ãƒ­ãƒƒã‚¯**ã®ä¸€é€£ãƒ•ãƒ­ãƒ¼ã‚’ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ„Ÿæ“ä½œã€‚
  - **å†ç¾é…æ…®**ï¼šä¹±æ•°ã‚·ãƒ¼ãƒ‰ãƒ»baselineãƒ­ãƒƒã‚¯ãƒ»ãƒ­ã‚°å‡ºåŠ›ã§é‹ç”¨ã‚’å®‰å®šåŒ–ã€‚

> ğŸ’¡åˆå›ã‚’ **ç„¡æŒ‡å®šã§å®Ÿè¡Œ**ã™ã‚‹ã¨ã€è‡ªå‹•ã§ãƒ™ã‚¹ãƒˆ Plan ãŒæ¡ç”¨ã•ã‚ŒåŸºæº–ãŒä½œæˆã•ã‚Œã¾ã™ã€‚  
> ã€€ æ„å›³ã‚’æ˜ç¤ºã—ãŸã„å ´åˆã¯ `--show-candidates â†’ --use-plan N` ã‚’æ¨å¥¨ã€‚

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰

```powershell
git clone https://github.com/AI-NOSUKE/PVM.git
cd PVM
python -m venv .venv
.\.venv\Scripts\activate    # Windows
# source .venv/bin/activate # macOS/Linux
pip install -r requirements.txt
```

- Python 3.11+ æ¨å¥¨ã€‚åˆå›ã¯åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«å–å¾—ã§å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

<a id="qs-ci"></a>
### â‘  CIã‚µãƒ³ãƒ—ãƒ«ï¼ˆå¿…ãšé€šã‚‹æœ€å°ãƒ†ã‚¹ãƒˆï¼‰

å›ºå®šãƒ‡ãƒ¼ã‚¿ï¼ˆ`examples/sample_texts.csv`ã€åˆ—å `text`ï¼‰ã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ã€‚

```powershell
# å€™è£œæ¢ç´¢
python PVM.py --input_csv examples/sample_texts.csv --text_col text --show-candidates

# Planæ¡ç”¨ï¼ˆä¾‹ï¼šrank=1ï¼‰
python PVM.py --use-plan 1

# 2å›ç›®ä»¥é™ã¯ãƒ­ãƒƒã‚¯é©ç”¨
python PVM.py

# æŸ”è»Ÿé©ç”¨ï¼ˆæ–°è©±é¡Œã®å¸åï¼‰
python PVM.py --unlock
```

<a id="qs-local"></a>
### â‘¡ ãƒ­ãƒ¼ã‚«ãƒ«åˆ©ç”¨ï¼ˆæœ€å°ã‚³ãƒãƒ³ãƒ‰ï¼‰

ã‚ãªãŸã®CSVã®ãƒ†ã‚­ã‚¹ãƒˆåˆ—åãŒ **`text`** ãªã‚‰ `--text_col` ã¯ä¸è¦ã€‚  
è¤‡æ•°ã®è©¦è¡Œçµæœã‚’åˆ†ã‘ãŸã„æ™‚ã ã‘ `--project` ã‚’ä»˜ã‘ã¾ã™ã€‚

```powershell
# å€™è£œæ¢ç´¢
python PVM.py --show-candidates

# Planæ¡ç”¨
python PVM.py --use-plan 1

# 2å›ç›®ä»¥é™ï¼ˆãƒ­ãƒƒã‚¯é©ç”¨ï¼‰
python PVM.py

# æŸ”è»Ÿé©ç”¨ï¼ˆã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼‰
python PVM.py --unlock
```

ğŸ‘‰ ã‚µãƒ³ãƒ—ãƒ«CSVã¯ã“ã¡ã‚‰ï¼š[examples/sample_texts.csv](examples/sample_texts.csv)

<details>
<summary><b>å‚è€ƒ: å®Ÿè¡Œãƒ­ã‚°ã®ä¾‹ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹ï¼‰</b></summary>

```text
INFO PVM: embedding model = cl-nagoya/ruri-v3-310m
INFO PVM: candidates search k in [8..16], seed=42
INFO PVM: stage-2 compare TOP5 â†’ results written to PVMresult/k_candidates_stage2.csv
INFO PVM: global plan rank=1 selected â†’ baseline saved to PVMresult/baseline_1å›ç›®/
INFO PVM: locked apply done â†’ results written to PVMresult/çµæœã‚¹ã‚³ã‚¢.csv
```
</details>

---

## ä¸»ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆåŸºæœ¬ï¼‰

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|---|---|
| *(ç„¡æŒ‡å®š)* | æ—¢å­˜ã®åŸºæº–ã§ãƒ­ãƒƒã‚¯é©ç”¨ã€‚**åˆå›ã¯è‡ªå‹•æ¡ç”¨ã§åŸºæº–ä½œæˆ** |
| `--show-candidates` | å€™è£œã®ã¿å‡ºåŠ›ï¼ˆåŸºæº–ã¯ä½œã‚‰ãªã„ï¼‰ |
| `--use-plan N` | å€™è£œã® **rank=N** ã‚’æ¡ç”¨ã—ã¦åŸºæº–ä½œæˆ |
| `--unlock` | æŸ”è»Ÿé©ç”¨ï¼šæ–°è©±é¡Œã‚’è¿½åŠ ã‚¯ãƒ©ã‚¹ã‚¿ã§å¸å |
| `--input_csv PATH` / `--input_xlsx PATH` | å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æŒ‡å®šï¼ˆã„ãšã‚Œã‹ä¸€ã¤ï¼‰ |
| `--text_col NAME` | ãƒ†ã‚­ã‚¹ãƒˆåˆ—åï¼ˆæ—¢å®š `text`ï¼‰ |
| `--project NAME` | å‡ºåŠ›ã®ä¿å­˜å…ˆåï¼ˆä¾‹ï¼š`1å›ç›®` / `2å›ç›®`ï¼‰ |

> è£œè¶³ï¼š`--id_col` ã¯ä»»æ„ï¼ˆæœªæŒ‡å®šãªã‚‰å†…éƒ¨ä»˜ç•ªï¼‰ã€‚

---

## è£œåŠ©ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆãã®ä»–ï¼‰

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|---|---|
| `--unlock-q Q` | æ–°è©±é¡Œæ¤œå‡ºã®è·é›¢åˆ†ä½ç‚¹ï¼ˆ0<**Q**<1ã€æ—¢å®š 0.90ï¼‰ |
| `--unlock-add-k K` | è¿½åŠ ã‚¯ãƒ©ã‚¹ã‚¿ã®ä¸Šé™ï¼ˆæ—¢å®š 2ï¼‰ |
| `--max_ic_cols N` | `çµæœã‚¹ã‚³ã‚¢.csv` ã«å‡ºåŠ›ã™ã‚‹ IC åˆ—ã®ä¸Šé™ |
| `--k_min N` / `--k_max N` | å€™è£œæ¢ç´¢ã® K ç¯„å›² |
| `--embedding_model NAME` | æ—¢å®šï¼š`cl-nagoya/ruri-v3-310m` |
| `--batch N` / `--max_len N` | åŸ‹ã‚è¾¼ã¿ã®ãƒãƒƒãƒã‚µã‚¤ã‚º/æœ€å¤§é•· |
| `--pca_var R` | PCA ã®ç´¯ç©å¯„ä¸ï¼ˆæ—¢å®š 0.90ï¼‰ |
| `--random_state S` | ä¹±æ•°ã‚·ãƒ¼ãƒ‰ |
| `--log_level LEVEL` | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ï¼ˆINFO/DEBUG ãªã©ï¼‰ |
| **æ—¥æœ¬èªalias** | `--å€™è£œè¡¨ç¤º` / `--æ¡ç”¨ãƒ—ãƒ©ãƒ³` / `--æŸ”è»Ÿé©ç”¨` ãªã©ï¼ˆåˆ©ä¾¿æ€§å‘ã‘ã®è£œåŠ©ï¼‰ |

---

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

ä»£è¡¨çš„ãªæˆæœç‰©ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã« `PVMresult/` ä»¥ä¸‹ã¸ä¿å­˜ï¼‰ï¼š

- `çµæœã‚¹ã‚³ã‚¢.csv` â€¦ å„å€™è£œ/å„ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚¹ã‚³ã‚¢ãƒ»IC æŒ‡æ¨™  
- `çµæœãƒ¬ãƒãƒ¼ãƒˆ.json` â€¦ å®Ÿè¡Œæƒ…å ±ãƒ»æ¡ç”¨ Plan ãªã©ã®ãƒ¡ã‚¿  
- `AI_å‘½åä¾é ¼.md` â€¦ ã‚¯ãƒ©ã‚¹ã‚¿å‘½åä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬  
- `k_candidates.csv` â€¦ å€™è£œä¸€è¦§ï¼ˆä¸€æ¬¡ï¼‰  
- `k_candidates_stage2.csv` â€¦ äºŒæ®µéšå¾Œã®å€™è£œæ¯”è¼ƒï¼ˆTOP5 ç­‰ï¼‰  
- `k_candidates_assignments.csv` â€¦ å‰²å½“æƒ…å ±ã®ã‚µãƒãƒª  
- `logs/` â€¦ å®Ÿè¡Œãƒ­ã‚°

---

## é‹ç”¨ã®ç›®å®‰ã¨å†ç¾æ€§

- **ä»¶æ•°ãƒ¬ãƒ³ã‚¸**ï¼šè¶…å°‘é‡ï¼ˆä¾‹ï¼š<30ï¼‰ã§ã¯å€™è£œæ¢ç´¢ãŒç²—ããªã‚Šã¾ã™ã€‚ååˆ†ãªä»¶æ•°ã‚’æ¨å¥¨ã€‚  
- **åˆå›ã®è‡ªå‹•æ¡ç”¨**ï¼šç„¡æŒ‡å®šã§èµ°ã‚‰ã›ã‚‹ã¨è‡ªå‹•æ¡ç”¨ã§åŸºæº–ä½œæˆã€‚æ„å›³ã‚’å›ºå®šã—ãŸã„å ´åˆã¯ `--use-plan N` ã‚’æ˜ç¤ºã€‚  
- **å†ç¾æ€§**ï¼š`--random_state` ã®å›ºå®š + **baselineãƒ­ãƒƒã‚¯** é‹ç”¨ã‚’æ¨å¥¨ã€‚  
- **ãƒ¢ãƒ‡ãƒ«ä¾å­˜**ï¼šåŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã‚’å¤‰ãˆã‚‹ã¨è»¸è§£é‡ˆãŒå¤‰ã‚ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼ˆæ—¢å®šã¯ Ruriï¼‰ã€‚

---

## å­¦è¡“èƒŒæ™¯ï¼ˆè¦ç‚¹ï¼‰

- **ICAâ‘ **ï¼šæ½œåœ¨å› å­ã‚’ç‹¬ç«‹åŒ–ã—ã¦ã€Œæ··ã˜ã£ã¦è¦‹ãˆã«ãã„æ„å‘³ã€ã‚’åˆ†é›¢ã€‚  
- **KMeansâ‘ **ï¼šå¤§æ ã®ç¾¤ã‚Œï¼ˆãƒˆãƒ”ãƒƒã‚¯ï¼‰ã‚’æŠŠæ¡ã€‚  
- **ICAâ‘¡ï¼ˆé‡å¿ƒå†åˆ†è§£ï¼‰**ï¼šã‚¯ãƒ©ã‚¹ã‚¿é‡å¿ƒå‘¨ã‚Šã®è»¸ã‚’å†æ§‹æˆã—ã¦**è¼ªéƒ­ã‚’æ˜ç¢ºåŒ–**ã€‚  
- **KMeansâ‘¡**ï¼šæœ€çµ‚ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ç¢ºå®šã€‚  
ã“ã® **äºŒæ®µéš ICA** ã«ã‚ˆã‚Šã€å˜æ®µéšã‚ˆã‚Šã‚‚**è§£é‡ˆã—ã‚„ã™ã„è»¸**ã¨**å®‰å®šã—ãŸã‚¯ãƒ©ã‚¹ã‚¿**ãŒå¾—ã‚‰ã‚Œã‚„ã™ãã€ãƒãƒ¼ã‚±æ´»ç”¨ï¼ˆå‘½åãƒ»è¦ç´„ãƒ»ç¤ºå”†æŠ½å‡ºï¼‰ã§åŠ¹ãã¾ã™ã€‚

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ / ä½œè€…

- **License**ï¼šPVM License v1.2ï¼ˆè©³ç´°ã¯ `LICENSE` / `LICENSE_FAQ.md` ã‚’å‚ç…§ï¼‰
- **Author**ï¼šAI-NOSUKEï¼ˆé€æ˜ãƒšã‚¤ãƒ³ã‚¿ãƒ¼ / Phantom Color Painterï¼‰
